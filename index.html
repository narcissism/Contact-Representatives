<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Contact Representatives</title>

<style>
body {
  background: white;
  font-family: Arial, sans-serif;
  margin: 40px;
}

h1 { margin-bottom: 10px; }

.controls {
  margin-bottom: 20px;
}

.member {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  padding: 14px 0;
}

.member img {
  width: 80px;
  height: 100px;
  object-fit: cover;
  border-radius: 6px;
}

.info b {
  font-size: 18px;
}

button, select {
  margin-right: 10px;
  padding: 6px 10px;
}
</style>
</head>

<body>

<h1>Current US Representatives</h1>

<div class="controls">
  <select id="stateFilter" onchange="filterState()">
    <option value="ALL">All States</option>
  </select>

  <button onclick="sortBy('state')">Sort by State</button>
  <button onclick="sortBy('party')">Sort by Party</button>
  <button onclick="sortBy('chamber')">Sort by Chamber</button>
</div>

<div id="list"></div>

<script>
let members = [];
let filtered = [];

fetch("members.json")
  .then(r => r.json())
  .then(data => {
    members = data;
    filtered = data;
    populateStates();
    render();
  })
  .catch(() => {
    document.getElementById("list").innerHTML =
      "members.json missing â€” run GitHub Action.";
  });

function populateStates() {
  const states = [...new Set(members.map(m => m.state))].sort();
  const dropdown = document.getElementById("stateFilter");

  states.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s;
    opt.textContent = s;
    dropdown.appendChild(opt);
  });
}

function filterState() {
  const state = document.getElementById("stateFilter").value;
  filtered = state === "ALL"
    ? members
    : members.filter(m => m.state === state);
  render();
}

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  filtered.forEach(m => {
    const div = document.createElement("div");
    div.className = "member";

    const phoneDigits = m.phone
      ? m.phone.replace(/[^0-9]/g, "")
      : "";

    div.innerHTML = `
      <img src="${m.photo || ''}"
           onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png'">

      <div class="info">
        <b>${m.name}</b><br>
        ${m.party} â€” ${m.chamber.toUpperCase()} â€” ${m.state}<br>

        State Office ZIP: ${m.zipcode || "Not found"}<br>

        Phone: ${m.phone || "Not found"}<br>
        ${phoneDigits ? `<a href="tel:${phoneDigits}">ðŸ“ž Click to Call</a><br>` : ""}

        Email: ${m.email || "Not found"}<br>

        ${m.website ? `<a href="${m.website}" target="_blank">Official Website</a>` : ""}
      </div>
    `;

    list.appendChild(div);
  });
}

function sortBy(field) {
  filtered.sort((a,b) =>
    (a[field] || "").localeCompare(b[field] || "")
  );
  render();
}
</script>

</body>
</html>
